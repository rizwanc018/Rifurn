<div class="page-banner-section section bg-image" data-bg="./assets/images/bg/breadcrumb.jpg"
    style="background-image: url(/images/banner.webp);">
    <div class="container">
        <div class="row">
            <div class="col">

                <div class="page-banner text-center">
                    <h2>Orders</h2>
                    <ul class="page-breadcrumb">
                        <li><a href="/">Home</a></li>
                        <li>Orders</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="cart-section section pt-100 pt-lg-80 pt-md-70 pt-sm-60 pt-xs-50 ">
    <div class="container sb-border pb-70 pb-lg-50 pb-md-40 pb-sm-30 pb-xs-20">
        <div class="row">
            <div class="col-12 my-5">
                <!-- Cart Table -->
                <div class="cart-table table-responsive mb-30">
                    <table class="table">
                        <thead>
                            <tr>
                                <th class="pro-date">Date</th>
                                <th class="pro-thumbnail">Image</th>
                                <th class="pro-title">Product</th>
                                <th class="pro-quantity">Quantity</th>
                                <th class="pro-status">Status</th>
                                <th class="pro-remove">Cancel</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each orderData }}
                            <tr data-orderId="{{_id}}">
                                <td class="pro-date"><span>{{createdAt}}</span></td>
                                <td class="pro-thumbnail"><a href=""><img
                                            src="http://res.cloudinary.com/dz9knbtwi/image/upload/v1680054685/{{image}}.webp"
                                            alt="Product"></a></td>
                                <td class="pro-title"><span>{{result.productName}}</span></td>
                                <td class="pro-quantity"><span>{{items.quantity}}</span></td>
                                {{!-- <td class="pro-price"><span>$25.00</span></td> --}}
                                <td class="pro-status"><span
                                        class="text-capitalize text-primary status">{{items.orderStatus}}</span>
                                </td>
                                {{#noteq items.orderStatus "cancelled"}}
                                <td class="pro-remove">
                                    <button data-productId={{items.productId}} onclick="cancelOrder(this)"
                                        class="btn px-1">
                                        <i class="fa fa-close"></i>
                                    </button>
                                </td>
                                {{else}}
                                <td class="pro-remove">
                                </td>
                                {{/noteq}}
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $('.status').each(function () {
        if (this.innerHTML === "cancelled") {
            this.classList.add('text-danger')
        }
        else if (this.innerHTML === "dispatched") {
            this.classList.add('text-success')
        }
    })

    var url = window.location.origin
    function cancelOrder(self) {
        const $tr = $(self).closest('tr')
        const orderId = $tr.attr('data-orderId')
        const prodId = $(self).attr('data-productId')
        const status = $($tr).find('.status')
        swal.fire({
            title: "Delete?",
            text: `Are you sure you want to cancel order`,
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes",
            closeOnConfirm: false
        }).then(function (result) {
            if (result.isConfirmed) {
                $.ajax({
                    url: `${url}/user/cancel/order`,
                    method: 'POST',
                    data: { orderId, prodId },
                    success: res => {
                        status.html("Cancelled")
                        status.addClass('text-danger')
                        self.remove()
                        console.log(res)
                    },
                    error: err => {
                        console.log(err)
                    }
                })

            }
        })
    }
</script>